<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot Test</title>
    <style>
      #chatbox {
        height: 300px;
        width: 400px;
        border: 1px solid #ccc;
        overflow-y: scroll;
        padding: 10px;
      }
      .message {
        margin-bottom: 10px;
        padding: 5px;
        border-radius: 5px;
      }
      .user-message {
        background-color: lightblue;
      }
      .bot-message {
        background-color: lightgreen;
      }
    </style>
  </head>
  <body>
    <div id="chatbox"></div>

    <label for="mode-switch">Mode:</label>
    <select id="mode-switch">
      <option value="chat">Chat</option>
      <option value="summarize">Summarize</option>
    </select>

    <input type="text" id="message-input" />
    <button onclick="sendMessage()">Send</button>

    <script>
      const chatbox = document.getElementById("chatbox");
      const messageInput = document.getElementById("message-input");
      const modeSwitch = document.getElementById("mode-switch");

      async function sendMessage() {
        const message = messageInput.value;
        if (message.trim() === "") return;
        // Display user message
        const userMessageElement = document.createElement("div");
        userMessageElement.classList.add("message", "user-message");
        userMessageElement.textContent = message;
        chatbox.appendChild(userMessageElement);
        messageInput.value = ""; // Clear input
      
        const mode = modeSwitch.value;
        const endpoint = mode === "chat" ? "/chat" : "/summarize";
        const requestData =
          mode === "chat"
            ? { messages: [{ role: "user", content: message }] }
            : { file_name: message }; // send as object
      
        const response = await fetch(`http://127.0.0.1:8000${endpoint}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(requestData),
        });
        const data = await response.json();

        // Display bot response (or summary)
        const responseMessageElement = document.createElement("div");
        responseMessageElement.classList.add("message", "bot-message");
        responseMessageElement.textContent = data.response
        chatbox.appendChild(responseMessageElement);

        // Scroll to bottom
        chatbox.scrollTop = chatbox.scrollHeight;
      }
    </script>
  </body>
</html>
